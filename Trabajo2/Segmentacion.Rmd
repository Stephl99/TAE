---
title: "Segmentación para una base de datos simulada"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
suppressMessages(library(tidyverse))
suppressMessages(library(ggplot2))
suppressMessages(library(devtools))
suppressMessages(library(ggbiplot))
suppressMessages(library(corrplot))
suppressMessages(library(caret))
```


## Lectura de la base de datos:

```{r}
dtb <- read.csv("base.csv", sep = ";")
#dtb[32:length(dtb)] <- lapply(dtb[32:length(dtb)], factor)
```


## Reescalado de la base de datos:

```{r}
scaled_dtb <- scale(dtb[, 2:length(dtb)], center = TRUE, scale = TRUE)
```


```{r}
dim(scaled_dtb)
#cluster_h <- hclust(scaled_dtb, method = "complete")
```



## Análisis descriptivo de los datos:

```{r}
correlations <- cor(scaled_dtb)
corrplot(correlations)
```

```{r}
dtb1 <- scaled_dtb[,1:31]
corr1 <- cor(dtb1)
corrplot(corr1)

```


```{r}
dtb2 = dtb[32:length(dtb)]
corrplot(cor(dtb2))

```

```{r}
summary(dtb[,c("pagos_pj", "pagos_pn") ])
plot( dtb$pagos_pn, dtb$pagos_pj)
abline(v=0.5)
```


```{r}
par(mfrow=c(1,2))
hist(dtb$en_vm_canal1)
hist(dtb$en_vm_canal2)
```
```{r}
canalt = rowSums(dtb[, 2:11])/1e11
quantile(canalt, c(0.8, 0.9, 0.999999999))
hist(canalt, ylim = c(0,50))
```



## Análisis de componentes principales:

```{r}
dtb1_pca <- princomp(dtb1)
#ggbiplot(dtb1_pca, group=dtb2$tiene_ventas_fisicas) + ylim(-1,1) + xlim(-1,1)
```


```{r}
indices <- sample(2232, 500)
test_dtb <- dtb1[indices,]
```


```{r}
distances <- dist(scaled_dtb)
htest <- hclust(distances)
```


```{r}
plot(htest)
```


```{r}
scaled_pca <- princomp(scaled_dtb)
ggbiplot(scaled_pca) + xlim(-1,1) + ylim(-1,1)
```
```{r}
summary(scaled_pca)
```

```{r}
plot(scaled_pca,type = 'l')
```


