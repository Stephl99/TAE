---
title: "Trabajo 1"
author: "Predicción del número de hijos de los hogares colombianos"
output:
  html_document: default
  pdf_document: default
---

# Integrantes
* Santiago Franco Valencia
* Stephany Lobo
* Isabela Lujan Jaramillo
* Daniel Alexander Naranjo Ríos
* Ana María Sánchez Henao

```{r a, include=FALSE}
library(ggplot2)
library(gridExtra)
library(GGally)
library(Amelia)
library(reticulate)
```


```{r setup, include=FALSE}
setwd("C:/Users/s540/Documents/U/Semestres/2021-1S/TAE/TRABAJO 1")
load("datos.RData")
```

# Objetivo
El objetivo de este trabajo es predecir el número de hijos que hay en los hogares colombianos a partir de características específicas partiendo de la encuesta de calidad de vida más reciente publicada por el DANE (2019).

# Introducción
Las encuestas dirigidas a hogares constituyen una de las principales fuentes de datos socioeconómicos con las que cuentan los países. A partir de la información obtenida de ellas se calculan indicadores para la medición de variados aspectos económicos y sociales. Además, facilitan el conocimiento y explicación de los determinantes o factores causales del comportamiento de dichos aspectos, lo cual es de gran importancia para el diseño, monitoreo y medición de resultados de las políticas públicas.” (DANE, 2018). Por ello son herramientas muy usadas actualmente por el gobierno, aprovechando la alta capacidad  que tienen para recoger grandes cantidades de información rápidamente, sobre todo cuando dicha información proviene de la percepción que tiene el pueblo o las condiciones en las que cada ciudadano vive. Para ello, se crearon instituciones como el departamento administrativo nacional de estadísticas (DANE), que se encarga de planear, recopilar, procesar, analizar y difundir las estadísticas oficiales referentes a información de interés referente a varias situaciones actuales del país y su población.



# Contextualización de la encuesta
Las encuestas a hogares normalmente se centran en temas específicos como, por ejemplo, la Encuesta de Mercado Laboral (Gran Encuesta Integrada de Hogares) que se aplica en forma regular y continua durante todo el año. Otro ejemplo es la Encuesta Nacional de Presupuestos de los Hogares que se aplica cada diez años. Si bien estas encuestas indagan sobre algunos aspectos que permiten hacer análisis particulares del bienestar, no brindan información que posibilite conocer íntegramente las diferentes variables que determinan las condiciones de vida del hogar en todas sus dimensiones.” (DANE, 2018). Estas encuestas incluso abarcan temas como la calidad de vida de los colombianos, como lo hace la encuesta nacional de calidad de vida, la cual es realizada por el DANE cada año aproximadamente, y que será la base de donde se extraerá la información para este trabajo. Tomando en cuenta cada una de las variables presentadas en la misma y depurando aquellas que no sean de interés para el objetivo final.

# Problemas encontrados 


# Variables a considerar 

La encuesta se encuentra conformada por 14 bases de datos en total. Para la selección de variables se realizó un estudio riguroso de las variables a considerar teniendo en cuenta características específicas del hogar y del jefe de hogar. La base de datos tiene 93993 registros y 57 variables. A continuación un listado de las variables seleccionadas por cada base de datos.

### Datos de la vivienda
* Alcantarillado:  (1. Sí - 2. No)
* Acueducto:  (1. Sí - 2. No)
* Estrato para tarifa:
1. Bajo - Bajo
2. Bajo
3. Medio - Bajo
4. Medio
5. Medio - Alto
6. Alto
8. Planta eléctrica
9. No conoce el estrato o no cuenta con recibo de pago.
0. Recibos sin estrato o el servicio es pirata
* Tipo de vivienda:
1. Casa
2. Apartamento
3. Cuarto(s)
4. Vivienda tradicional indigena
5. Otro (carpa, contenedor, vagón, embarcación, cueva, refugio natural, etc)
* Región:
1. Caribe
2. Oriental
3. Central
4. Pacífica(sin valle)
5. Bogotá
6. Antioquia
7. Valle del cauca
8. San Andrés
9. Orinoquía - amazonía

### Servicios del hogar (PENDIENTE)
* Número de cuartos que dispone el hogar
* Número de dormitorios que dispone el hogar
* Cortes o suspensiones de energía por falta de pago: (1. Sí - 2. No)
* Cambios bruscos del voltaje
* Bajo voltaje
* Iluminación principal 
* Servicio de gas natural
* Tipo servicio sanitario
* Ubicación servicio sanitario
* Lavadero
* Lavamanos
* Lavaplatos
* Jabón de manos
* Clasificación basura
* Bombillas bajo consumo
* Plancha
* Reutiliza agua
* Recolecta agua lluvia
* Tanque sanitario bajo consumo
* Obtención de agua para alimentos
* Servicio agua 24 horas
* Ubicación preparación energía
* Tipo de energía
* Cantidad de personas en el hogar
### Caracteristicas y composicion del hogar
* Conyuges:
0. No tiene
1. Sí vive en el hogar
2. No vive en el hogar
* El padre vive en el hogar:
1. Sí
2. No
3. Fallecido
* Educación padre:
1. Primaria incompleta
2. Primaria completa
3. Secundaria incompleta
4. Secundaria completa
5. Tecnica incompleta
6. Tecnica completa
7. Universidad incompleta
8. Universidad completa
9. Ninguno
10. No sabe
* La madre vive en el hogar:
1. Sí
2. No
3. Fallecida
* Educación madre:
1. Primaria incompleta
2. Primaria completa
3. Secundaria incompleta
4. Secundaria completa
5. Tecnica incompleta
6. Tecnica completa
7. Universidad incompleta
8. Universidad completa
9. Ninguno
10. No sabe
* Cultura
1. Indígena
2. Gitano (a) (Rom)
3. Raizal del archipiélago de San Andrés, Providencia y Santa Catalina
4. Palenquero (a) de San Basilio
5. Negro (a), mulato (a) (afrodescendiente), afrocolombiano(a)
6. Ninguno de los anteriores
* Es campesino (1. Sí - 2. No)
* Condición de vida
0 significa que se siente "totalmente insatisfecho" y 10 significa que se
siente "totalmente satisfecho".


### Tenencia y financiación de la vivienda que ocupa el hogar
* La vivienda ocupada por este hogar es:
1. Propia, totalmente pagada
2. Propia, la están pagando
3. En arriendo o subarriendo
4. Con permiso del propietario, sin pago alguno (usufructuario)
5. Posesión sin título (ocupante de hecho)
6. Propiedad colectiva
* ¿Cuánto pagan mensualmente por arriendo?

###  Uso de energéticos del hogar
* Número de computadores en el hogar

### Fuerza de trabajo
* Exige mucho esfuerzo físico
* Exige mucho esfuerzo intelectual

# ¿Cómo se encontró y?

De la base de datos características y composición del hogar se tomó la variable P6051 correspondiente a una pregunta hecha a cada miembro del hogar, la cual era ¿cuál es la dirección directa con el jefe(a) de hogar? El número 3 correspondía a los hijos.

También se realizó un ID único que uniera las bases de datos de hogares y personas, por medio de este ID único se buscaba tener un índice único para cada hogar, este fue asignado a la base de datos servicio del hogar ya que esta base en total contaba el número de hogares únicos. 

Una vez obtenido el índice se unieron las bases de datos de servicios del hogar y composición del hogar, se filtraron todos los "3" de la variable P6051 la cual correspondía al número de hijos en todos los hogares. Se realizó un conteo por cada índice único del hogar para los hijos y se creó una nueva variable.

Para garantizar que los datos no eran repetidos, en la base de datos de servicios del hogar, se extrayeron los conteos para eliminar las observaciones repetidas correspondientes a las personas que hacían parte del hogar para obtener finalmente la variable hijos por cada hogar. 



# Análisis descriptivo 

El primer filtro para descartar alguna de las variables consiste en graficar boxplots para variables categóricas y gráficos de dispersión para las variables numéricas, al ser tantas variables se mostrará algunos ejemplos de las variables que descartamos y las que por su resultado, se considerarán en el modelo.





### Variables categóricas

Se encontraron muchas variables que no son significativas a la hora de graficarlas ya que su media permanecía constante al número de hijos y se pudo comprobar que no aportaban mucha información, un ejemplo de estos gráficos se encuentra a continuación:

```{r, tidy=TRUE, out.width="80%",fig.align="center"}
################ gráficos juntos #########################
# fuente principal de energia
a <- ggplot(aes(y= hijos, x = ilum_ppal), data=datos) + geom_boxplot() +
  xlab("fuente principal de energía") 
# agua 24 horas
b <- ggplot(aes(y= hijos, x = agua_24h), data=datos) + geom_boxplot() +
  xlab("agua 24 horas")
# estrato
c <- ggplot(aes(y= hijos, x = estrato), data=datos) + geom_boxplot() + 
  xlab("estrato para tarifa")
# corte luz
d <- ggplot(aes(y= hijos, x = corte_energia_fp), data=datos) + geom_boxplot() + xlab("corte de luz por falta de pago")
grid.arrange(a, b,c,d)
```

En estos gráficos se observa que para variables como fuente principal de energía, si la vivienda tenía agua las 24 horas del día, estrato por tarifa y algún corte de luz en los últimos 30 días no aportan mucha información para el número de hijos, contrario a lo que se pensaba, pues son variables directamente relacionadas con la calidad de vida.

Por otro lado, también se encontraron variables que aunque su variación no es mucha, se consideró prudente dejarlas para la implementación del modelo, pues se llegó a la conclusión que eran importantes a la hora de evaluar el número de hijos. Alguna de estas variables son:

```{r, out.width="80%",fig.align="center"}
# boxplot tipo de vivienda
e <- ggplot(aes(y= hijos, x =tipo_vivienda), data=datos) + geom_boxplot()+xlab("tipo de vivienda")
# obtención agua
f <- ggplot(aes(y= hijos, x = obtencion_agua_alimento), data=datos) + geom_boxplot() + xlab("obtención de agua para alimentos")
# conyugues
g <- ggplot(aes(y= hijos, x = conyuges), data=datos) + geom_boxplot() +
  xlab("conyuge vive en el hogar")
# cultura
h <- ggplot(aes(y= hijos, x =cultura), data=datos) + geom_boxplot()
grid.arrange(e,f,g,h)
```

Cabe recalcar que aunque se piense que son necesarias solamente el modelo podrá decir qué tan significativas son y si efectivamente se deben retirar.

### Variables continuas

```{r b,out.width="80%",fig.align="center"}
# cantidad personas
i <- ggplot(datos, aes(x=as.factor(CANT_PERSONAS_HOGAR) )) +
  geom_bar(color="blue", fill=rgb(0.1,0.4,0.5,0.7) ) +
  xlab("cantidad personas en el hogar") + ylab("frecuencia")
# número dormitorios
j <- ggplot(datos, aes(x=as.factor(num_dormitorios) )) +
  geom_bar(color="blue", fill=rgb(0.1,0.4,0.5,0.7) ) +
  xlab("numero de dormitorios") + ylab("frecuencia")
# número computadores
k <- ggplot(datos, aes(x=as.factor(num_computadores) )) +
  geom_bar(color="blue", fill=rgb(0.1,0.4,0.5,0.7) )+
  xlab("numero de computadores") + ylab("frecuencia")
grid.arrange(i,j,k)
```

La mayoría de hogares están conformados por entre dos y tres personas, también se encontró que el número de cuartos más recurrente es uno, y al preguntar por cantidad de computadores en el hogar, los gráficos indican que la mayoría respondieron entre no tiene y solo uno en el hogar.

### Valores faltantes

Con ayuda del siguiente gráfico se detectaron los valores faltantes que se encontraban en la base de datos.

```{r, out.width="80%",fig.align="center"}
missmap(datos, main = "Valores faltantes vs. Observados")
```

Las variables en las que se encontraron valores faltantes además de las que se pueden observar en el gráfico son:

* ubicación servicio sanitario
* educación madre
* condición de vida
* tipo energía
* estrato
* es campesino

La manera de resolver los datos faltantes consistió en hacer un reemplazo en los valores faltantes con la moda correspondiente de cada columna ya que como se observa en el gráfico, los valores faltantes corresponden solo al 1% de los datos en total. 

# Selección de variables

Aunque el análisis descriptivo dio una idea intuitiva de cuáles variables podrían ser seleccionadas en el modelo, el grupo decidió que era importante requerir una prueba específica para la selección de variables.

El método empleado para la selección de variables fue con la prueba estadística chi-cuadrado la cual devuelve las 10 variables más relacionadas con la variable respuesta, en este caso, las variables que tuvieran una relación fuerte con los hijos. Los resultados obtenidos son:

| Variable | Puntaje |
|:-:|:-:|
| I_UGASTO | 2.095865e+09 |
| I_HOGAR | 2.067919e+09 |
| arriendo | 1.376606e+08 |
| CANT_PERSONAS_HOGAR | 5.841541e+04 |
| num_dormitorios | 9.660812e+03 |
| tipo_serv_sanitario | 2.351219e+03 |
| conyuges | 2.028149e+03 |
| num_cuartos | 1.416181e+04 |
| obtencion_agua_alimento | 1.343717e+03 |

Finalmente, estas son las 10 variables seleccionadas para el modelo.

_nota_ este método fue empleado en Python. [Link](https://colab.research.google.com/drive/1tdPmb7ntUu1AwwgactC-YXp6LC4eptlF?authuser=1#scrollTo=tdLbPiuH26ed/ "Colaboratory") 

# Definición del usuario
# Materiales
# Métodos
# Resultados
# Conclusiones
# Bibliografía




