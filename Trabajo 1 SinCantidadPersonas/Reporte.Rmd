---
title: "Trabajo 1 - T√©cnicas en Aprendizaje Estad√≠stico"
author: "Predicci√≥n del n√∫mero de hijos de los hogares colombianos"
date: \today
output:
  html_document: default
  pdf_document: default
---

## Integrantes

* Santiago Franco Valencia
* Isabela Lujan Jaramillo
* Ana Mar√≠a S√°nchez Henao
* Daniel Alexander Naranjo R√≠os
* Stephany Michell Lobo Laguado

```{r a, include=FALSE}
library(ggplot2)
library(gridExtra)
library(GGally)
library(Amelia)
library(reticulate)
library(knitr)
library(dplyr)
library(MASS)
library(caret)
library(caTools)
```


```{r setup, include=FALSE}
load("C:/Users/ASUS/Desktop/2021-1/TAE/Correccion_T1/datos.RData")
```

## Objetivo:

El objetivo de este trabajo es predecir la cantidad de hijos en un hogar colombiano a partir de caracter√≠sticas espec√≠ficas, partiendo de la Encuesta Nacional de Calidad de Vida - ECV 2019, publicada por el Departamento Administrativo Nacional de Estad√≠stica DANE.

## Introducci√≥n:  

Las encuestas dirigidas a los distintos hogares constituyen una de las principales fuentes de datos socioecon√≥micos con las que cuentan los pa√≠ses. A partir de la informaci√≥n obtenida de ellas, es posible calcular indicadores para la medici√≥n de variados aspectos econ√≥micos y sociales; adem√°s, facilitan el conocimiento y explicaci√≥n de los determinantes o factores causales del comportamiento de dichos aspectos, lo cual es de gran importancia para el dise√±o, monitoreo y medici√≥n de resultados de las pol√≠ticas p√∫blicas.‚Äù (DANE, 2018)  

Por ello, estas encuestas son herramientas muy usadas actualmente por el gobierno, aprovechando la alta capacidad  que tienen para recoger grandes cantidades de informaci√≥n r√°pidamente, sobre todo cuando dicha informaci√≥n proviene de la percepci√≥n que tiene el pueblo o las condiciones en las que cada ciudadano vive. Para ello, se crearon instituciones como el el Departamento Administrativo Nacional de Estad√≠stica DANE, que se encarga de planear, recopilar, procesar, analizar y difundir las estad√≠sticas oficiales referentes a informaci√≥n de inter√©s sobre varias situaciones actuales del pa√≠s y su poblaci√≥n.

## Contextualizaci√≥n de la encuesta:

Las encuestas a hogares normalmente se centran en temas espec√≠ficos como, por ejemplo, la Encuesta de Mercado Laboral (Gran Encuesta Integrada de Hogares) que se aplica en forma regular y continua durante todo el a√±o. Otro ejemplo es la Encuesta Nacional de Presupuestos de los Hogares que se aplica cada diez a√±os. Si bien, estas encuestas indagan sobre algunos aspectos que permiten hacer an√°lisis particulares del bienestar, no brindan informaci√≥n que posibilite conocer √≠ntegramente las diferentes variables que determinan las condiciones de vida del hogar en todas sus dimensiones.‚Äù (DANE, 2018)

Estas encuestas incluso abarcan temas como la calidad de vida de los colombianos, como lo hace la Encuesta Nacional de Calidad de Vida - ECV, la cual es realizada por el DANE cada a√±o aproximadamente; la informaci√≥n m√°s reciente publicada por el DANE sobre esta encuesta fue la base de donde se recopil√≥, depur√≥ y analiz√≥ informaci√≥n para el desarrollo de este documento.

## Problemas encontrados:

Inicialmente, se deb√≠an recopilar los datos, presentes en la p√°gina del DANE, que correspond√≠an a informaci√≥n sobre la [Encuesta Nacional de Calidad de Vida - ECV 2019](http://microdatos.dane.gov.co/index.php/catalog/678/study-description).

El problema inicial, se encontr√≥ al momento de realizar una exploraci√≥n general de los datos por la forma en la que estos se encontraban distribuidos; la Encuesta Nacional de Calidad de Vida - ECV, fue una encuesta realizada por medio de muestreo triet√°pico, considerando municipios del pa√≠s, diferentes sectores del municipio y segmentos de cada sector como unidades de muestreo. Adicionalmente, se queria obtener informaci√≥n sobre distintos temas tales como salud, educaci√≥n, situaci√≥n econ√≥mica y otras caracter√≠sticas para cada hogar dentro de la muestra, por lo que la informaci√≥n suministrada se encontraba dividida de acuerdo a los distintos agentes del hogar que fueron encuestados; se encontraron datos correspondientes a la vivienda de la cual hac√≠a parte el hogar, datos para cada uno de estos hogares, y adem√°s, datos sobre cada una de las personas que hac√≠an parte de los hogares dentro de la muestra.

Al tener la informaci√≥n divida de esta manera, se deb√≠a buscar alguna forma en que la informaci√≥n sobre la cu√°l se hiciera un an√°lisis, se encontrara en t√©rminos de cada hogar dentro de la muestra, que era la unidad de estudio que se reguer√≠a.

Para obtener una predicci√≥n sobre el n√∫mero de hijos en un hogar, se requer√≠a el uso de alguna metodolog√≠a de modelos de regresi√≥n, en los cuales se requieren ajustar modelos, por medio del m√©todo de validaci√≥n cruzada. Para esto se necesitaba darle al modelo un conjunto de variables que dieran informaci√≥n sobre el hogar, las cuales actuar√≠an como predictores de la variable respuesta, que ser√≠a el n√∫mero de hijos en cada uno de los hogares del conjunto de muestra.

Debido a que los datos proporcionados por la encuesta ten√≠an informaci√≥n tanto para la vivienda, el hogar y las personas el hogar, se necesitaba definir un conjunto de variables predictoras a partir de estos datos que dieran informaci√≥n sobre cada uno de los hogares considerados en la muestra.

Otro problema con los datos era que, para utilizar validaci√≥n cruzada, se requer√≠a que el conjunto de datos tambi√©n tuviera a la variable respuesta dentro de √©l, es decir, se necesitaba una variable que diera cuenta del n√∫mero de hijos presentes en cada uno de los hogares del conjunto de muestra.

Esta variable no estaba expl√≠citamente definida dentro de los datos proporcionados en la encuesta por lo que deb√≠a ser inferida por medio de otra informaci√≥n.

## Variables a considerar: 

La informaci√≥n recolectada por la Encuesta Nacional de Calidad de Vida - ECV 2019 se encuentra conformada por 14 bases de datos en total. Para la selecci√≥n de variables se realiz√≥ un estudio riguroso de las variables a considerar teniendo en cuenta caracter√≠sticas espec√≠ficas del hogar y del jefe de hogar. 

La variable inicial a considerar en el conjunto de datos fue el numero de hijos para cada hogar, la cual, como se dijo anteriormente, no estaba definida de manera explic√≠ta, por lo tuvo que construirse a partir de otra informaci√≥n que s√≠ era suministrada. 

Debido a que las bases de datos ten√≠an informaci√≥n sobre viviendas, hogares y personas, se deb√≠an considerar los datos dieran informaci√≥n sobre los hogares dentro de la muestra. Se tomo inicialmente el conjunto de datos de "Servicios del hogar", el cual conten√≠a 93993 registros y 57 variables con informaci√≥n sobre c√≥mo eran adquiridos en el hogar los servicios b√°sicos de agua, luz y electricidad, as√≠ como diversa informaci√≥n asociada a estos servicios (tipo de servicio, clasificaci√≥n de desechos, etc).

Con estos datos, ya se sab√≠a entonces que el n√∫mero de hogares a considerar era de 93993, y con estos datos como base, se a√±adieron algunas variables que se consideraron pod√≠an llegar a tener relaci√≥n con el n√∫mero de hijos. 

Estas variables a√±adidas fueron tomadas de los conjuntos de datos "Datos de Vivienda", "Caracter√≠sticas y composici√≥n del hogar", "Uso de energ√©ticos del hogar" y "Fuerza de trabajo", tomando para cada hogar, es decir, el registro correspondiente a cada jefe del hogar, la siguiente informaci√≥n:

1. **Regi√≥n** (1 Caribe, 2 Oriental, 3 Central, 4 Pac√≠fica(sin valle), 5 Bogot√°, 6 Antioquia, 7 Valle del cauca, 8 San Andr√©s, 9 Orinoqu√≠a - amazon√≠a). 

2. **Tipo de vivienda** (1 Casa, 2 Apartamento, 3 Cuarto(s), 4 Vivienda tradicional indigena, 5 Otro (carpa, contenedor, vag√≥n, embarcaci√≥n, cueva, refugio natural, etc)). 
 
3. **Energ√≠a el√©ctrica** (0 - no, 1 - si). 

4. **estrato** *de recibo de electricidad* (1 Bajo - Bajo, 2 Bajo, 3 Medio - Bajo, 4 Medio, 5 Medio - Alto, 6 Alto, 8 Planta el√©ctrica, 9 No conoce el estrato o no cuenta con recibo de pago, 0 Recibos sin estrato o el servicio es pirata). 

5. **acueducto** (0 - no, 1 - si). 

6. **alcantarillado** (0 - no, 1 - si). 

7. **vivienda_ocupada** *¬øLa vivienda ocupada por este hogar es?* (1 Propia - totalmente pagada, 2. Propia - la est√°n pagando, 3 En arriendo o subarriendo, 4 Con permiso del propietario - sin pago alguno (usufructuario), 5 Posesi√≥n sin t√≠tulo (ocupante de hecho), 6 - Propiedad colectiva). 

8. **arriendo** *¬øcu√°nto pagan mensualmente por arriendo?*. 

9. **num_computadores** *N√∫mero de computadores en el hogar*.

10. **fisico_t**  *el trabajo del jefe del hogar exige mucho esfuerzo fisico* (0 - no, 1 - si). 

11. **intelectual_t** *el trabajo del jefe del hogar exige mucho esfuerzo intelectual* (0 - no, 1 - si).

12. **conyuges** (0 No tiene, 1 Si vive en el hogar, 2 No vive en el hogar)

13. **padre_hogar** *padre de los hijos vive en el hogar* (1 si, 2 no, 3 fallecido).

14. **educacion_padre** *educaci√≥n del padre* (1 primaria incompleta, 2 primaria completa, 3 secundaria incompleta, 4 secundaria completa, 5 tecnica incompleta, 6 tecnica completa, 7 universidad incompleta, 8 universitaria completa, 9 Ninguno, 10 No sabe). 

15. **madre_hogar** *madre de los hijos vive en el hogar* (1 si, 2 no, 3 fallecida). 

16. **educacion_madre** *educaci√≥n de la madre* (1 primaria incompleta, 2 primaria completa, 3 secundaria incompleta, 4 secundaria completa, 5 tecnica incompleta, 6 tecnica completa, 7 universidad incompleta, 8 universitaria completa, 9 Ninguno, 10 No sabe). 

17. **cultura** (1 Ind√≠gena, 2 Gitano (a) (Rom), 3 Raizal del archipi√©lago de San Andr√©s, Providencia y Santa Catalina, 4 Palenquero (a) de San Basilio, 5 Negro (a), mulato (a) (afrodescendiente), afrocolombiano(a), 6 Ninguno de los anteriores). 

18. **es_campesino** (1 Si, 2 No, 3 No informa).

19. **condicion_vida** *¬øEn cu√°l escal√≥n dir√≠a usted que se encuentra parado(a) en este momento?* (10 Mejor vida, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0 Peor vida).


**Nota: ** La uni√≥n de los datos se hizo siguiendo el documento gu√≠a suministrado en la p√°gina de la encuesta, en el que se daba informaci√≥n sobre las variables llave que un√≠an las distintas tablas de viviendas, hogares y personas.

## ¬øC√≥mo se encontr√≥ la variable respuesta $y$?

De la base de datos "Caracter√≠sticas y composici√≥n del hogar" se tom√≥ la variable "P6051", en la que se le pregunt√≥ a cada uno de los miembros del hogar "¬øcu√°l es la relaci√≥n directa con el jefe(a) de hogar?". 

Las personas que eran hijos del jefe del hogar, tenian un valor de 3 en la columna de esta variable; se filtraron los datos de las personas que eran hijos, es decir, los valores de 3 en la variable "P6051" para todos los hogares, y se realiz√≥ un conteo de las observaciones que se repet√≠an para cada hogar, a partir de un √≠ndice √∫nico creado para distinguir cada hogar; este √≠ndice √∫nico se creo pegando los valores de las variables que funcionaban como llave para una las bases de datos que conten√≠an informaci√≥n de los hogares.

Este conteo se guard√≥ en otra variable, que correspond√≠a al n√∫mero de hijos, pero como estos datos iban a estar para cada una de las personas del hogar por estar en una base de datos de personas, se encontraban repetidos. Para proyectar esta informaci√≥n en t√©rminos de los hogares, se uni√≥ esta variable, identificada con el √≠ndice √∫nico creado para cada hogar, con la tabla de "Servicios del hogar", la cual conten√≠a informaci√≥n para cada uno de los hogares y no de las personas. 

Al tener la variable de hijos dentro de la tabla de "Servicios del hogar", simplemente se uni√≥ a la base de datos construida con las dem√°s variables anteriormente definidas.

## An√°lisis descriptivo :

El primer filtro para descartar algunas de las variables consiste en graficar boxplots para variables categ√≥ricas y gr√°ficos de dispersi√≥n para las variables num√©ricas. A continuaci√≥n se rpesentan algunos gr√°ficos usados para descartar variables no relacionadas con el n√∫mero de hijos del hogar:

### Variables categ√≥ricas:

Se encontraron muchas variables que no son significativas a la hora de graficarlas ya que su media permanec√≠a constante al n√∫mero de hijos y se pudo comprobar que no aportaban mucha informaci√≥n, un ejemplo de estos gr√°ficos se encuentra a continuaci√≥n:

```{r, tidy=TRUE, out.width="80%",fig.align="center"}
################ gr√°ficos juntos #########################
# fuente principal de energia
a <- ggplot(aes(y= hijos, x = ilum_ppal), data=datos) + geom_boxplot() +
  xlab("fuente principal de energ√≠a") 
# agua 24 horas
b <- ggplot(aes(y= hijos, x = agua_24h), data=datos) + geom_boxplot() +
  xlab("agua 24 horas")
# estrato
c <- ggplot(aes(y= hijos, x = estrato), data=datos) + geom_boxplot() + 
  xlab("estrato para tarifa")
# corte luz
d <- ggplot(aes(y= hijos, x = corte_energia_fp), data=datos) + geom_boxplot() + xlab("corte de luz por falta de pago")
grid.arrange(a, b,c,d)
```

En estos gr√°ficos se observa que para variables como fuente principal de energ√≠a, si la vivienda ten√≠a agua las 24 horas del d√≠a, estrato por tarifa y alg√∫n corte de luz en los √∫ltimos 30 d√≠as, no aportan mucha informaci√≥n para el n√∫mero de hijos, contrario a lo que se pensaba, pues son variables directamente relacionadas con la calidad de vida.

Por otro lado, tambi√©n se encontraron variables que aunque su variaci√≥n no es mucha, se consider√≥ prudente dejarlas para la implementaci√≥n del modelo, pues se lleg√≥ a la conclusi√≥n que eran importantes a la hora de evaluar el n√∫mero de hijos. Alguna de estas variables son:

```{r, out.width="80%",fig.align="center"}
# boxplot tipo de vivienda
e <- ggplot(aes(y= hijos, x =tipo_vivienda), data=datos) + geom_boxplot()+xlab("tipo de vivienda")
# obtenci√≥n agua
f <- ggplot(aes(y= hijos, x = obtencion_agua_alimento), data=datos) + geom_boxplot() + xlab("obtenci√≥n de agua para alimentos")
# conyugues
g <- ggplot(aes(y= hijos, x = conyuges), data=datos) + geom_boxplot() +
  xlab("conyuge vive en el hogar")
# cultura
h <- ggplot(aes(y= hijos, x =cultura), data=datos) + geom_boxplot()
grid.arrange(e,f,g,h)
```

Cabe recalcar que, aunque se piense que son necesarias, por medio de m√©todos de selecci√≥n de variables es que se decidi√≥ finalmente qu√© tan significativas eran algunas variables o si efectivamente se deb√≠an retirar para hacer el ajuste del modelo.

### Variables num√©ricas:

```{r b,out.width="80%",fig.align="center"}
# cantidad personas
i <- ggplot(datos, aes(x=as.factor(CANT_PERSONAS_HOGAR) )) +
  geom_bar(color="blue", fill=rgb(0.1,0.4,0.5,0.7) ) +
  xlab("cantidad personas en el hogar") + ylab("frecuencia")
# n√∫mero dormitorios
j <- ggplot(datos, aes(x=as.factor(num_dormitorios) )) +
  geom_bar(color="blue", fill=rgb(0.1,0.4,0.5,0.7) ) +
  xlab("numero de dormitorios") + ylab("frecuencia")
# n√∫mero computadores
k <- ggplot(datos, aes(x=as.factor(num_computadores) )) +
  geom_bar(color="blue", fill=rgb(0.1,0.4,0.5,0.7) )+
  xlab("numero de computadores") + ylab("frecuencia")
grid.arrange(i,j,k)
```

La mayor√≠a de hogares est√°n conformados por entre dos y tres personas; adem√°s, se encontr√≥ que el n√∫mero de cuartos m√°s recurrente es uno, y al preguntar por cantidad de computadores en el hogar, los gr√°ficos indican que la mayor√≠a respondieron entre no tiene o solo tiene uno en el hogar.


```{r, out.width="60%",fig.align="center"}
options("scipen"=100, "digits"=4)
truehist(datos$I_HOGAR, xlim = c(0,8000000), 
         main = "Histograma para la variable Ingreso del Hogar",
         xlab = "Ingreso del Hogar",
         yaxp = c(0,0.5,2))

truehist(datos$I_UGASTO, xlim = c(0,8000000), 
         main = "Histograma para la variable Gasto del Hogar",
         xlab = "Gasto del Hogar",
         yaxp = c(0,0.5,2))

truehist(datos$arriendo, xlim = c(0,1000000), 
         main = "Histograma para la variable Valor del arriendo",
         xlab = "Valor del Arriendo",
         yaxp = c(0,0.5,2))
```

Los histogramas permiten observar el comportamiento de la distribuci√≥n de las variables "Ingreso el Hogar","Gasto del Hogar" y "Valor del arriendo". Para las dos primeras, se evidencia una asimetr√≠a positiva en el comportamiento de sus distribuciones, mientras que para la tercera, el comportamiento en particular se debe a que la mayor√≠a de los hogares no pagan arriendo.

### Valores faltantes:

Con ayuda del siguiente gr√°fico se detectaron los valores faltantes que se encontraban en la base de datos:

```{r, out.width="80%",fig.align="center"}
missmap(datos, main = "Valores faltantes vs. Observados")
```

Se puede observar que no hay gran presencia de valores faltantes en relaci√≥n con la cantidad total de datos; adem√°s, otras variables en las que se encontraron valores faltantes fueron:

* ubicaci√≥n del servicio sanitario (dentro o fuera del hogar)
* educaci√≥n de la madre
* condici√≥n de vida
* tipo energ√≠a
* estrato
* es campesino

La manera de resolver los datos faltantes consisti√≥ en hacer un reemplazo en los valores faltantes con la moda correspondiente de cada columna (por tratarse de variables categ√≥ricas en su mayor√≠a) ya que como se observa en el gr√°fico, los valores faltantes corresponden solo al 1% de los datos en total. 

## Selecci√≥n de variables:

Aunque el an√°lisis descriptivo dio una idea intuitiva de cu√°les variables podr√≠an ser seleccionadas en el modelo, se decidi√≥ que era importante requerir de una prueba espec√≠fica para la selecci√≥n de variables.

El m√©todo empleado para la selecci√≥n de variables fue por medio de la **selecci√≥n univariada**, el cual se basa en la prueba estad√≠stica chi-cuadrado para hacer una selecci√≥n que devuelve las 10 variables m√°s relacionadas con la variable respuesta. [Informaci√≥n y gu√≠a](https://towardsdatascience.com/feature-selection-techniques-in-machine-learning-with-python-f24e7da3f36e)

En este caso, las variables que tuvierOn una relaci√≥n fuerte con los hijos fueron:

| Variable | Puntaje |
|:-:|:-:|
| I_UGASTO | 2095865000 |
| I_HOGAR | 2067919000 |
| arriendo | 137660600 |
| num_dormitorios | 9660.812 |
| tipo_serv_sanitario | 2351.219 |
| conyuges | 2028.149 |
| num_cuartos | 14161.81 |
| obtencion_agua_alimento | 1343.717 |

Finalmente, estas fueron las 10 variables seleccionadas para la modelaci√≥n.


**Nota: ** este m√©todo fue empleado en [Python](https://colab.research.google.com/drive/1tdPmb7ntUu1AwwgactC-YXp6LC4eptlF?authuser=1). 

La definci√≥n expl√≠cita de las variables utilizadas en la modelaci√≥n se encuentra a continuaci√≥n: 

### Variable respuesta:

**hijos** Se refiere al n√∫mero de hijos del jefe de cada hogar.

### Variables predictoras:

1. **I_HOGAR** ingreso mensual del hogar. 
2. **I_UGASTO** gasto mensual del hogar. 
3. **arriendo** arriendo mensual que se paga en el hogar. 
4. **num_dormitorios** n√∫mero de habitaciones en las que duermen las personas del hogar. 
5. **num_cuartos** n√∫mero de habitaciones del hogar. 
6. **tipo_serv_sanitario** 1 Inodoro conectado a alcantarillado, 2 Inodoro conectado a pozo s√©ptico, 3 Inodoro sin conexi√≥n, 4 Letrina, 5 Inodoro con descarga directa a fuentes de agua (bajamar), 6 No tiene servicio sanitario.
7. **conyuges** 0 No tiene, 1 Si vive en el hogar, 2 No vive en el hogar. 
8. **obtencion_agua_alimento** 1 Acueducto p√∫blico, 2 Acueducto comunal o veredal, 3 Pozo con bomba, 4 Pozo sin bomba-aljibe-jag√ºey-barreno, 5 Agua lluvia, 6 R√≠o-quebrada-manantial-nacimiento, 7 Pila p√∫blica, 8 Carro tanque, 9 Aguatero, 10 Agua embotellada o en bolsa.

```{r}

variables <- c("I_UGASTO", "I_HOGAR", "arriendo", "num_dormitorios",
         "tipo_serv_sanitario", "conyuges", "num_cuartos",
         "obtencion_agua_alimento", "hijos")
base_nueva <- datos[,variables]

```

## Materiales

Se utiliz√≥ R y R studio para el preprocesamiento de los datos, as√≠ como tambi√©n para an√°lisis descriptivos, modelaci√≥n y escritura del reporte por medio de la herramienta R Markdown.

Adicionalmente, se us√≥ del lenguaje de programaci√≥n Python por medio de Google Collab para realizar la selecci√≥n de variables.

## M√©todos

El siguiente paso era entrenar un modelo que pudiera predecir la cantidad de hijos por hogar. 

Se us√≥ la t√©cnica de **validaci√≥n cruzada**, la cual consiste en realizar una partici√≥n del total de los datos en subconjuntos que se utilizan m√°s adelante para entrenar y evaluar el modelo predictivo.

Un 75% de los datos fue utilizado para realizar el entrenamiento del modelo, y el 25% restante se utiliz√≥ para evaluar el comportamiento de este.

```{r}
set.seed(123)   
sample = sample.split(base_nueva,SplitRatio = 0.75) 
train1 =subset(base_nueva,sample ==TRUE) 
test1=subset(base_nueva, sample==FALSE)
```

Debido a que la variable respuesta, que es el n√∫mero de hijos de un hogar, se trata de una variable que toma valores discretos, se quer√≠a abordar el problema por medio de un modelo de clasificaci√≥n, por lo que inicialmente se probaron los siguientes modelos:


| Modelo | Accuracy Reportado |
|:-:|:-:|
| √Årbol de Clasificaci√≥n | 38.20 \% |
| Bosque Aleatorio | 76.97 \%|


Luego de recibir retroalimentaci√≥n y corrreccione pertinentes, se decide abordar el problema de la modelaci√≥n como un problema de regressi√≥n, para el cual se decidieron probar los siguientes modelos:

### Modelo de regresi√≥n lineal m√∫ltiple

```{r, out.width="80%",fig.align="center"}
RL <- lm(hijos ~ ., data = train1)
summary(RL)
par(mfrow = c(2,2))
plot(RL, pch = 20)

```

A partir de los gr√°ficos de residuales se podr√≠a concluir que el modelo de regresi√≥n lineal m√∫ltiple no da un ajuste muy adecuado a los datos ya que:

* No se cumple el suspuesto de varianza constante, se aprec√≠an claros patrones en el gr√°fico de valores ajstados vs. residuales estandarizados 

* No se cumple el suuesto de normalidad de los errores ya que gr√°ficamente, los residuales no se ven exactamente sobre la l√≠nea de los cuantiles te√≥ricos.

* Hay gran presencia de valores at√≠picos o puntos leverage

### Modelo de los K v√©cinos m√°s cercanos - kNN

Inicialmente se reescalan las variables num√©ricas y se realiza de nuevo la partici√≥n de los datos en un conjunto de datos de entrenamiento y un conjunto de datos de prueba, de acuerdo al m√©todo de validaci√≥n cruzada:

```{r}
base_nueva <- base_nueva %>%
  mutate(num_dormitorios = as.factor(num_dormitorios)) %>% 
  mutate(num_cuartos = as.factor(num_cuartos)) 

base_nueva$I_UGASTO <- scale(base_nueva$I_UGASTO)
base_nueva$I_HOGAR<- scale(base_nueva$I_HOGAR)
base_nueva$arriendo <- scale(base_nueva$arriendo)


set.seed(123)   
sample = sample.split(base_nueva,SplitRatio = 0.75) 
train1 =subset(base_nueva,sample ==TRUE) 
test1=subset(base_nueva, sample==FALSE)
```

Para ajustar un modelo kNN, se necesita primero conocer un valor √≥ptimo para el n√∫mero de vecinos m√°s cercanos que se van a tomar:

```{r include=FALSE}
set.seed(123)
setControl <- trainControl(
  method = "cv",
  number = 10,
  verboseIter = F
)
```

```{r}
fit <- train(hijos ~ .,
             method = "knn",
             tuneGrid = expand.grid(k=1:10),
             trControl = setControl,
             metric ="RMSE",
             data = base_nueva)
fit$bestTune
plot(fit, xlab = "N√∫mero de vecinos")
```


Se puede observar que el RMSE se minimiza en valores mayores o iguales a 8. Lo siguiente fue ajustar un modelo kNN de cuerdo al k √≥ptimo encontrado, k = 10.

```{r}
knn <- knnreg(train1[,-9], train1[,9])
p2 <- predict(knn, train1[,-9])
error <-mean((p2 - train1[,9])^2)
rmse_knn <-sqrt(error)
rmse_knn
```

En resumen, en el conjunto de datos de entrenamiento se ajustaron dos modelo para los cuales se obtuvieron los siguientes resultados: 

| Modelo | RMSE |
|:-:|:-:|
| Regresi√≥n lineal M√∫ltiple | 1 |
| K vecinos m√°s cercanos | 0.8711 |


En conclusi√≥n, entre los dos modelos de regresi√≥n trabajados, se obtuvieron mejores resultados con el m√©todo de los k vecinos m√°s cercanos - kNN.

Por √∫ltimo, comprobando en el conjunto de datos de validaci√≥n:

```{r}
p2_val <- predict(knn, test1[,-9])

error_val <-mean((p2_val - test1[,9])^2)
rmse_knn_val <-sqrt(error)

```

El RMSE del modelo de los k vecinos m√°s cercanos en el conjunto de datos de validaci√≥n fue de 0.9874.

## Definici√≥n de la app Shiny y el usuario

Con el modelo seleccionado se implement√≥ la app Shiny ["Ramilia"](https://isabelaunal.shinyapps.io/AppPredecirHijos/), que sirve para obtener predicciones sobre el n√∫mero de hijos en un hogar, ingresando la siguiente informaci√≥n: gasto mensual del hogar en pesos colombianos, ingreso mensual del hogar en pesos colombianos, arriendo mensual del hogar en pesos colombianos, n√∫mero total de habitaciones en el hogar, n√∫mero total de dormitorios en el hogar, tipo de servicio sanitario en el hogar, si el conyuge del jefe del hogar vive en el hogar y c√≥mo se obtiene el agua para la preparaci√≥n de alimentos en el hogar.

La aplicaci√≥n se encuentra dirigida a cualquier persona o entidad que desee tomar decisiones acorde a la composici√≥n de un hogar en Colombia, entre estas pueden estar:

- Entidades finacieras
- Entes pol√≠ticos
- Entidades de salud
- Sector educacional
- Aseguradoras 
- Entre otros

## Conclusiones

Finalmente, a pesar de que el modelo trabajado hace parte de los modelos de regresi√≥n, tambi√©n se obtuvieron resultados interesantes abordando el objetivo del trabajo como un problema de clasificaci√≥n.

##  Bibliograf√≠a, referencias y gu√≠as

* Gonzalez, L., &amp; Correa de Carvalho , M. (2020, July 13). √Årboles de DecisioÃÅn ClasificacioÃÅn ‚Äì Teor√≠a. ü§ñ Aprende IA.(https://aprendeia.com/arboles-de-decision-clasificacion-teoria-machine-learning/)

* Gonzalez, L. (2019, November 15). Bosques Aleatorios Clasificaci√≥n ‚Äì Teor√≠a. ü§ñ Aprende IA. https://aprendeia.com/bosques-aleatorios-clasificacion-teoria-machine-learning/#:~:text=Se%20puede%20utilizar%20para%20clasificar,de%20datos%20dividido%20al%20azar

* Rodrigo, J. A. (2020, August). Machine learning con Python y Scikit-learn. Machine Learning con Python y Scikitlearn. (https://www.cienciadedatos.net/documentos/py06_machine_learning_python_scikitlearn.html

* Shaikh, R. (2018, October 28). Feature Selection Techniques in Machine Learning with Python. Medium. https://towardsdatascience.com/feature-selection-techniques-in-machine-learning-with-python-f24e7da3f36e. 
